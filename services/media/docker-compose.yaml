services:
  jellyfin:
    container_name: jellyfin
    image: linuxserver/jellyfin:10.11.6
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Amsterdam
    volumes:
      - /media/hd2/data:/data
      - /home/${USERNAME}/services_data/jellyfin/config:/config
      - /dev/dri:/dev/dri
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8096"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s

  jellyseerr:
    image: fallenbagel/jellyseerr:latest
    container_name: jellyseerr
    restart: unless-stopped
    environment:
      - LOG_LEVEL=debug
      - TZ=Europe/Amsterdam
    volumes:
      - /home/${USERNAME}/services_data/jellyseerr/config:/app/config
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:5055/api/v1/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s

  gluetun:
    container_name: gluetun
    image: qmcgaw/gluetun
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    volumes:
      - /home/${USERNAME}/services_data/gluetun:/gluetun
    environment:
      - TZ=Europe/Amsterdam
      - VPN_SERVICE_PROVIDER=surfshark
      - VPN_TYPE=openvpn
      - OPENVPN_USER=${TRANSMISSION_OPENVPN_USERNAME}
      - OPENVPN_PASSWORD=${TRANSMISSION_OPENVPN_PASSWORD}
      - SERVER_COUNTRIES=Netherlands,Belgium
    healthcheck:
      test: ping -c 1 www.google.com || exit 1
      interval: 60s
      timeout: 20s
      retries: 5

  qbittorrent:
    container_name: qbittorrent
    image: lscr.io/linuxserver/qbittorrent:latest
    restart: unless-stopped
    network_mode: service:gluetun
    depends_on:
      - gluetun
    volumes:
      - /home/${USERNAME}/services_data/qbittorrent/config:/config
      - /media/hd2/data:/data
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Amsterdam
      - WEBUI_PORT=8080
      - TORRENTING_PORT=6881

  prowlarr:
    container_name: prowlarr
    image: linuxserver/prowlarr:2.3.0
    restart: unless-stopped
    network_mode: service:gluetun
    depends_on:
      - gluetun
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Amsterdam
    volumes:
      - /home/${USERNAME}/services_data/prowlarr/config:/config
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9696/ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s

  sonarr:
    container_name: sonarr
    image: linuxserver/sonarr:4.0.16
    restart: unless-stopped
    network_mode: service:gluetun
    depends_on:
      - gluetun
    environment:
      - PUID=0
      - PGID=0
      - TZ=Europe/Amsterdam
    volumes:
      - /home/${USERNAME}/services_data/sonarr/config:/config
      - /media/hd2/data:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8989/ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s

  radarr:
    container_name: radarr
    image: linuxserver/radarr:6.0.4
    restart: unless-stopped
    network_mode: service:gluetun
    depends_on:
      - gluetun
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Amsterdam
    volumes:
      - /home/${USERNAME}/services_data/radarr/config:/config
      - /media/hd2/data:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7878/ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s

  profilarr:
    container_name: profilarr
    image: santiagosayshey/profilarr:latest
    volumes:
      - /home/${USERNAME}/services_data/profilarr/config:/config
    environment:
      - TZ=Europe/Amsterdam
    ports:
      - 6868:6868

  flaresolverr:
    container_name: flaresolverr
    image: ghcr.io/flaresolverr/flaresolverr:latest
    restart: unless-stopped
    network_mode: service:gluetun
    depends_on:
      - gluetun
    environment:
      - TZ=Europe/Amsterdam

  sabnzbd:
    container_name: sabnzbd
    image: lscr.io/linuxserver/sabnzbd:latest
    restart: unless-stopped
    network_mode: service:gluetun
    depends_on:
      - gluetun
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Amsterdam
    volumes:
      - /home/${USERNAME}/services_data/sabnzbd/config:/config
      - /media/hd2/data:/data

  navidrome:
    container_name: navidrome
    image: deluan/navidrome:0.59.0
    restart: unless-stopped
    user: 1000:1000
    volumes:
      - /home/${USERNAME}/services_data/navidrome:/data
      - /media/hd2/data/media/music:/music:ro
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:4533"]
      interval: 10s
      timeout: 5s
      retries: 5

  audiobookshelf:
    container_name: audiobookshelf
    image: ghcr.io/advplyr/audiobookshelf:latest
    restart: unless-stopped
    volumes:
      - /home/${USERNAME}/services_data/audiobookshelf/config:/config
      - /home/${USERNAME}/services_data/audiobookshelf/metadata:/metadata
      - /media/hd2/data/media/audiobooks:/audiobooks
      - /media/hd2/data/media/podcasts:/podcasts

networks:
  default:
    external: true
    name: home_server_network